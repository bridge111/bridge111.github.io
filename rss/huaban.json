[
  {
    "articleStyle": 2,
    "customOrder": -24383,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": true,
    "lastUpdateTime": 0,
    "loadWithBaseUrl": true,
    "ruleArticles": "$.pins",
    "ruleContent": "$.pin.file.key&&$.pin.board.pins[*].file.key\n<js>\n  li='\\n'\n  list=result.split('\\n')\n  for(i in list){\n  li += '<li><img data-src=\"http://hbimg.huaban.com/'+list[i]+'\" alt=\"图片\"></li>\\n'\n  }\n  li\n</js>\n\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n  <title>图片</title>\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n  <style>\n  :root {\n    --item-width: 97vw;\n    --aspect-ratio: 3/4;\n  }\n\n    body {\n      margin: 0;\n      padding: 20px 0;\n      background-color: floralwhite;\n      font-family: sans-serif;\n      min-height: 100vh;\n    }\n\n    h1{\n      text-align:center;\n      font-size:20px;\n      line-height:1.5em;\n    }\n    \t\n    p{\n      text-indent:2em;\n      padding:0 20px;\n      overflow-wrap: break-word;\n      word-break: break-all;\n    }\n    \n    .gallery {\n      list-style: none;\n      padding: 0;\n      margin: 0 auto;\n      width: calc(var(--item-width) - 30px);\n      max-width: 400px;\n    }\n\n    .gallery li {\n      width: 100%;\n      margin-bottom: 15px;\n      background: floralwhite;\n      border-radius: 8px;\n      overflow: hidden;\n      position: relative;\n      height: 0;\n      padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n\n    .gallery img {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      opacity: 0;\n      transition: opacity 0.4s ease-out;\n    }\n\n    .gallery img[loaded] {\n      opacity: 1;\n    }\n\n    .gallery img.error {\n      filter: grayscale(1);\n      background: repeating-linear-gradient( /* 条纹背景 */\n      45deg,\n      #f1f3f5,\n      #f1f3f5 10px,\n      #e9ecef 10px,\n      #e9ecef 20px\n      );\n    }\n\n    .gallery img.error::after {\n      content: \"加载失败\";\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      color: #ff6b6b;\n      font-size: 14px;\n      display: block;\n      z-index: 1;\n    }\n  </style>\n</head>\n<body>\n  <h1>{{$.pin.board.title}}</h1>\n  <p>By：{{$.pin.user.username}}</p>\n  <p>{{$.pin.raw_text}}</p>\n  <p>{{$.pin.board.description}}</p>\n  <ul class=\"gallery\">\n    {{result}}\n  </ul>\n\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n  <script>\n    const CONFIG = {\n      retry: {\n        maxAttempts: 3,\n        initialDelay: 1000,\n        backoff: 2\n      },\n      viewer: {\n        toolbar: {\n          zoomIn: 1,\n          zoomOut: 1,\n          oneToOne: 1,\n          reset: 1\n        },\n        transition: false,\n        navbar: false,\n        title: false\n      }\n    };\n\n    // Viewer实例管理\n    const viewerManager = {\n      instance: null,\n      isLoading: false,\n\n      async init() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n\n        this.destroy();\n        this.instance = new Viewer(document.querySelector('.gallery'), {\n          ...CONFIG.viewer,\n          url: 'data-src',\n          hidden: () => this.onViewerClose(),\n          ready: () => {\n            this.isLoading = false;\n            this.bindClickFallback();\n          }\n        });\n      },\n\n      onViewerClose() {\n        this.instance?.hide();\n      },\n\n      destroy() {\n        if (this.instance) {\n          try {\n            this.instance.destroy();\n            document.querySelectorAll('.viewer-container').forEach(container => container.remove());\n          } catch (e) {\n            console.error('Viewer销毁失败:', e);\n          }\n          this.instance = null;\n        }\n      },\n\n      bindClickFallback() {\n        document.querySelector('.gallery').addEventListener('click', (e) => {\n          const target = e.target.closest('img[loaded]');\n          if (target && this.instance) {\n            const index = Array.from(document.querySelectorAll('.gallery img')).indexOf(target);\n            this.instance.view(index);\n          }\n        });\n      }\n    };\n\n    // 图片加载控制\n    const imageLoader = {\n      loadAllImages() {\n        document.querySelectorAll('.gallery img').forEach(img => {\n          this.loadImage(img);\n        });\n      },\n\n      loadImage(img) {\n        if (img.src) return;\n\n        const src = `${img.dataset.src}?t=${Date.now()}`;\n        const tempImg = new Image();\n\n        tempImg.onload = () => {\n          const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n\n          img.parentElement.style.setProperty('--aspect-ratio', aspectRatio);\n\n          img.src = src;\n          img.setAttribute('loaded', '');\n          this.scheduleViewerUpdate();\n        };\n\n        tempImg.onerror = () => this.handleError(img);\n        tempImg.src = src;\n      },\n\n      handleError(img, attempt = 1) {\n        if (attempt > CONFIG.retry.maxAttempts) {\n          img.classList.add('error');\n          img.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPgogIDxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNlZWVlZWUiLz4KICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzk5OSI+CiAgICBsb2FkIGZhaWxlZAogIDwvdGV4dD4KPC9zdmc+';\n          img.alt = '图片加载失败';\n          return;\n        }\n\n        setTimeout(() => {\n          this.loadImage(img);\n        }, CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1));\n      },\n\n      scheduleViewerUpdate() {\n        requestAnimationFrame(() => {\n          viewerManager.instance?.update();\n        });\n      }\n    };\n   \n    document.addEventListener('DOMContentLoaded', () => {\n      viewerManager.init();\n      imageLoader.loadAllImages(); // 直接加载所有图片\n    });\n\n    const parentUl = document.querySelector('ul'); \n    const li2 = document.querySelectorAll('li')[1]; \n    const p = document.createElement('p');\n    p.textContent = '相关推荐：';\n    parentUl.insertBefore(p, li2);\n\n    window.addEventListener('resize', () => {\n      viewerManager.instance?.update();\n    });\n\n    window.addEventListener('beforeunload', () => {\n      viewerManager.destroy();\n    });\n  </script>\n</body>\n</html>",
    "ruleDescription": "",
    "ruleImage": "https://hbimg.huaban.com/{{$.file.key}}",
    "ruleLink": "https://api.huaban.com/pins/{{$.pin_id}}",
    "ruleNextPage": "@js:\nif (!/search/.test(baseUrl)) {\n    baseUrl.replace(/\\?max=\\d+&limit=20|\\?limit=20/g, '?max={{$.pins[-1].pin_id}}&limit=20');\n}\nelse baseUrl;",
    "rulePubDate": "{{java.timeFormatUTC(java.getString(\"created_at\")*1000,\"YYYY-MM-dd HH:mm:ss\",8)}}",
    "ruleTitle": "{{$.raw_text}}❤️{{$.board.like_count}}",
    "singleUrl": false,
    "sortUrl": "搜索::/search/?sort=all&q={{source.getVariable()=='' ? '美女':source.getVariable()}}&page={{page}}&per_page=20最新::/all/?limit=20\n美图::/all/quotes?limit=20\n明星::/all/people?limit=20\n美女::/all/beauty?limit=20\n摄影::/all/photography?limit=20\n插画::/all/illustration?limit=20\n游戏::/all/games?limit=20\n动漫::/all/anime?limit=20\n建筑::/all/architecture?limit=20\n工业::/all/industrial_design?limit=20\n极客::/all/geek?limit=20\n数据图::/all/data_presentation?limit=20\n汽车::/all/cars_motorcycles?limit=20\n电影::/all/film_music_books?limit=20\n人文::/all/art?limit=20\n家居::/all/home?limit=20\n女装::/all/apparel?limit=20\n男士::/all/men?limit=20\n美妆::/all/modeling_hair?limit=20\n手工::/all/diy_crafts?limit=20\n美食::/all/food_drink?limit=20\n旅行::/all/travel_places?limit=20\n婚礼::/all/wedding_events?limit=20\n儿童::/all/kids?limit=20\n宠物::/all/pets?limit=20\n礼物::/all/desire?limit=20\nUI/UX::/all/web_app_icon?limit=20\n平面::/all/design?limit=20\n生活::/all/tips?limit=20\n教育::/all/education?limit=20\n运动::/all/sports?limit=20\n搞笑::/all/funny?limit=20",
    "sourceComment": "By 平静",
    "sourceIcon": "https://calmss.netlify.app/img/huaban.png",
    "sourceName": "花瓣",
    "sourceUrl": "https://api.huaban.com/",
    "style": "",
    "variableComment": "搜索关键字"
  }
]